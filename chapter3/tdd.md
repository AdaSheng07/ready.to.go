## TDD 测试驱动开发

> 【思考】单元测试是必须的吗？怎么保证编写的代码符合预期？是先有主代码，再有测试案例；还是先有测试案例，后有主代码？单元测试会拖慢整个项目的进度吗？
>> 毫无疑问，单元测试是必须的。
>>
>> 保证代码符合预期的方法有：尝试使用各种功能（最终结果验证，量级较大时效率低）；自动化的单元测试。
>>
>> 为了使业务逻辑符合预期，开发某个功能，一定是收集案例信息以及结果，将它们与计算机程序运行后所得的结果进行比较，如果相同，说明符合验收标准。在项目开始之前，已经有了具体的预期。
>>
>> 在现实的项目开发中，都是现有测试案例，后有主代码。

在实际项目开发中，代码的编写所需时间往往只有几周甚至几天，代码的下线往往也只需要几天甚至更短的时间。

为了需求的增加和变更，代码是不断在更新迭代的，代码的维护几乎占据了它所有的生命周期，短到几年，长至几十年。这就需要我们考虑代码的维护成本。

代码的维护成本会随着时间的推移呈**指数型上升**：


![image](https://github.com/AdaSheng07/ready.to.go/blob/23d548801529edf1ae94ed4fb5eccb456965f221/pics/tdd_2.png)


- 代码的量越来越多
- 编码的人员越来越多
- 潜在的`bug`越来越多
- 承载的客户越来越多  
  ...

只有拥有足量的、高质量的测试案例，才能保证代码的交付质量。

### 🔸 什么是测试驱动开发？

测试驱动开发（TDD）是一种**由测试案例驱动编写代码**的开发方法。它从编写一个**不包含任何正式代码的测试案例**开始，然后编写正式代码使测试案例通过，最后在有测试案例保障的情况下进行**重构**，完成有质量保证的代码。

这需要我们精心设计单元测试案例，以完整覆盖我们的代码。可以对单元测试案例文件运行`run with Coverage`，显示它在这个`package`中代码的覆盖率。

怎样的理念与实践？

1. 根据一个功能需求，编写一个运行一定失败的测试案例/单元测试（UT）
2. 编写代码使得测试通过
3. 重构代码，使其覆盖率提高，增强健壮性
4. 再继续下一个功能...

![image](https://github.com/AdaSheng07/ready.to.go/blob/14e9e7ec7b09c9a374c5ea505eb56272d4cbddcd/pics/tdd_1.png)

### 🔸 实战案例：实现一个体脂排行榜

需求：
- 排行榜上根据最佳体脂进行排序，体脂最低的排最顶上
- 输入一个姓名，可以获取到他/她在排行榜的排名
- 如果一个参与者录入过多次，只按照他/她的最佳体脂进行排名
- 相同体脂的人排名相同
- 只录入姓名，不录入体脂的排在最下面

案例1：
- 王强第一次录入的时候，他的体脂是38
- 王强第二次录入的时候，他的体脂是32  
  此时，王强的最佳体脂是32
- 李静录入她的体脂是28  
  此时，李静的最佳体脂是28

李静排名第一，体脂28；王强排名第二，体脂32。

案例2：
- 王强录入体脂是38
- 张伟录入体脂是28
- 李静录入体脂是28

李静排名第一，体脂28，王强、张伟排名第二，体脂38。

案例3：
- 王强录入体脂是38
- 李静录入体脂是28
- 张伟注册成功，未录入体脂

李静排名第一，体脂28；王强排名第二，体脂28；张伟排名第三，没有体脂记录。

[>> 体脂排行榜代码实现](https://github.com/AdaSheng07/ready.to.go/blob/d03b189ffec1a1f0f6ba0b006909735c238b4a4f/chapter3/017.tdd/main.go)  
[>> 测试案例 Test Cases](https://github.com/AdaSheng07/ready.to.go/blob/d03b189ffec1a1f0f6ba0b006909735c238b4a4f/chapter3/017.tdd/main_test.go)