## Go Module åŸºç¡€

### ðŸ”¸ åˆè¯† Go Module

Go Moduleæ˜¯ Golang å®˜æ–¹æä¾›çš„ä¾èµ–ç®¡ç†æ–¹æ¡ˆã€‚ä¸€ä¸ª Go Module ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„ã€å¯ä½¿ç”¨çš„æ¨¡å—ã€‚

``` 
  module xxxx   // å®šä¹‰moduleçš„åç§°
  go 1.17       // å®šä¹‰golangçš„ç‰ˆæœ¬ï¼Œä¸åŒç‰ˆæœ¬çš„moduleè¡Œä¸ºä¸Šç•¥æœ‰åŒºåˆ«ï¼Œä½†æ ¸å¿ƒè§„åˆ™æ˜¯ç›¸åŒçš„
```
**åˆå§‹åŒ–Go Module**

Golang å®˜æ–¹æä¾›åˆå§‹åŒ– Go Module å‘½ä»¤è¡Œ`$ go mod init[module path]`:

[!image](https://github.com/AdaSheng07/ready.to.go/blob/3e4f5dd099b31633b4473288dc1b2b5c913879b9/pics/module_1.png)

- `[module path]`ä¸ºå¯é€‰å‚æ•°ï¼Œä½†å½“å…¶ä¸æ˜¯åœ¨`$GOPATH/src`æ–‡ä»¶å¤¹ä¸­æ—¶ï¼Œå¿…é¡»æŒ‡å®šã€‚`[module path]`ä¼šè¢«é»˜è®¤ä¸º`module`çš„åç§°ã€‚
- åœ¨`$GOPATH/src`æ–‡ä»¶å¤¹ä¸­æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šä»¥ç›¸å¯¹äºŽ`src`æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚
- ç”Ÿæˆçš„`go.mod`æ–‡ä»¶ä¸­ä¸åŒ…å« Golang å®˜æ–¹åŒ…ã€‚

### ðŸ”¸ Go Module å®žæˆ˜ä¾‹é¢˜

å¦‚æžœéœ€è¦åˆ©ç”¨ä»Žå‘½ä»¤è¡Œä¼ å…¥çš„æ•°æ®è¿›è¡Œè®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨`os.Args`ï¼š
  ```
  var (
      name   string
      sex    string
      height string // float64
      weight string // float64
      age    string // int
  )
  arguments := os.Args
  fmt.Println(arguments)
  ```
åœ¨è¿™é‡Œï¼Œ`arguments`æ˜¯ä¸€ä¸ªåˆ‡ç‰‡`slice`ï¼Œåœ¨ç¼–è¾‘é…ç½®ç»™å‡ºæ•°æ®åŽï¼Œæ‰“å°çš„`arguments`å¦‚ä¸‹ï¼š
  ```
  [/private/var/folders/7l/pnr12b8962l7dwhrxxzjd9500000gn/T/GoLand/___go_build_learn_go_chapter2_014_bfrCmdCalculator å°å¼º ç”· 1.7 70 35]
  name:  å°å¼º
  sex:  ç”·
  height:  1.7
  weight:  70
  age:  35
  ```
ç”±æ­¤å¯çŸ¥ï¼Œåˆ‡ç‰‡`arguments`çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ go æ–‡ä»¶æœ¬èº«ï¼Œä¼ å…¥çš„æ•°æ®ç´¢å¼•ä»Ž`1`å¼€å§‹ï¼Œè€Œä¸”æ•°æ®å¿…é¡»ä¸¥æ ¼æŒ‰ç…§é¡ºåºä¼ å…¥ï¼Œä¸”æ‰€æœ‰å½•å…¥æ•°æ®çš„æ ¼å¼éƒ½æ˜¯`string`ï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢ï¼Œè¿™æ ·çš„ç¨‹åºæ˜Žæ˜¾å¥å£®æ€§ä¸è¶³ã€‚

å¦‚ä½•æ”¹è¿›ï¼Ÿ

æˆ‘ä»¬å½“ç„¶å¯ä»¥å†™ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ï¼Œè§£é‡Šä¼ å…¥æ•°æ®çš„æ–¹æ³•å’Œè¦æ±‚ï¼Œä½†æ›´ç®€æ´çš„æ–¹æ³•æ˜¯å‚ç…§`git`çš„å‘½ä»¤è¡Œè¯­å¥ï¼Œç”¨ä¸åŒçš„å‚æ•°æ‰§è¡Œä¸åŒçš„åŠŸèƒ½ã€‚

**å¼•ç”¨ç¬¬ä¸‰æ–¹åŒ…**

åœ¨å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…æ—¶ï¼Œå¦‚æžœæ­¤åŒ…æœ¬åœ°ä»Žæœªç¼“å­˜è¿‡ï¼Œå¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªåˆ«åä¸º"`_`"çš„å¼•ç”¨ï¼Œç„¶åŽè¿è¡Œ`go mod tidy`æ¥è®©ç³»ç»Ÿåˆå§‹åŒ–å¼•å…¥çš„ç¬¬ä¸‰æ–¹çš„åŒ…ï¼Œç„¶åŽå†ä½¿ç”¨ã€‚

æ¯”å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬å¼•å…¥`cobra`ï¼š
  ```
  import (
      _ "github.com/spf13/cobra"
  )
  ```
å†åœ¨`Terminal`çš„`go.mod`æ–‡ä»¶è·¯å¾„ä¸‹æ‰§è¡Œ`go mod tidy`å®Œæˆé…ç½®ï¼š
  ```
  $ go mod tidy
  go: finding module for package github.com/spf13/cobra
  go: downloading github.com/spf13/cobra v1.3.0
  go: found github.com/spf13/cobra in github.com/spf13/cobra v1.3.0
  go: downloading github.com/inconshreveable/mousetrap v1.0.0
  go: downloading github.com/spf13/pflag v1.0.5
  ```

> ã€æ³¨æ„ã€‘è¿™é‡Œ`github.com/spf13/cobra`æ˜¯ç¬¬ä¸‰æ–¹åŒ…çš„è·¯å¾„ï¼Œ`cobra`æ˜¯ç›®å½•ä¸‹çš„æ–‡ä»¶åï¼Œå¹¶ä¸æ˜¯åŒ…çš„åç§°ã€‚`control/command` + å·¦é”®ç‚¹å‡»å¯ä»¥`goto`è‡ªåŠ¨è·³è½¬è‡³æ–‡ä»¶ç›®å½•ä¸‹è¿›è¡ŒæŸ¥çœ‹é¡¹ç›®æ­£åœ¨ä¾èµ–çš„åŒ…ï¼Œæ‰“å¼€å…¶ä¸­çš„ go æ–‡ä»¶å¯ä»¥æŸ¥çœ‹åŒ…çš„åç§°ï¼Œå¤§éƒ¨åˆ†å¼€æºç¤¾åŒºçš„ module æ–‡ä»¶åä¸ŽåŒ…åéƒ½æ˜¯ä¸€è‡´çš„ã€‚
>
> ![image](https://github.com/AdaSheng07/ready.to.go/blob/ab8d28ec0c11cd5b153f96f0baba3f7e133aed07/pics/package_3.png)

**ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…**

åˆ©ç”¨`cobra`åŒ…ä¸­çš„`Command`åŠŸèƒ½ä¼ å…¥è®¡ç®—ï¼Œæ›¿ä»£åŽŸä»£ç ä¸­çš„`os.Args`ã€‚å®šä¹‰å…¶ä¸­éœ€è¦çš„å˜é‡ï¼Œä»¥åŠå‘½ä»¤è¡Œå‚æ•°éœ€è¦çš„å‘½ä»¤è¡Œå¯¹è±¡ï¼š
  ```
  func main() {
      var (
          name   string
          sex    string
          height float64
          weight float64
          age    int
      )
      cmd := cobra.Command{
          Use:   "bfrCheck",    // use: set a name for this command
          Short: "åŸºäºŽBMIçš„ä½“è„‚è®¡ç®—å™¨", // short: a short description for this command
          // long: a detailed explanation for this command
          Long: "å½•å…¥å§“åã€æ€§åˆ«ã€èº«é«˜ã€ä½“é‡å’Œå¹´é¾„ï¼Œè®¡ç®—ä»–ä»¬çš„BMIå€¼ï¼ŒåŸºäºŽä»–ä»¬çš„æ€§åˆ«å’Œå¹´é¾„ç”Ÿæˆä»–ä»¬çš„ä½“è„‚çŽ‡æ ‡å‡†ï¼Œåˆ¤æ–­ä»–ä»¬çš„ä½“è„‚çŽ‡å¤„äºŽåç˜¦/æ ‡å‡†/åèƒ–/ä¸¥é‡è‚¥èƒ–å¹¶ç»™å‡ºå¥åº·å»ºè®®ã€‚",
          // func is a registered callback function, Run is the main body of cmd, custom-made as desired
          Run: func(cmd *cobra.Command, args []string) {
              fmt.Println("name: ", name)
              fmt.Println("sex: ", sex)
              fmt.Println("height: ", height)
              fmt.Println("weight: ", weight)
              fmt.Println("age: ", age)
              // calculate bmi & bfr...
              
              // healthiness assessment & suggestions
              
          },
      }
  ```
åˆ©ç”¨`Flags()`é…ç½®éœ€è¦çš„å„å‚æ•°ï¼š
  ```
      /*
          func (f *FlagSet) StringVar(p *string, name string, value string, usage string)
          StringVar defines a string flag with specified name, default value, and usage string.
          The argument p points to a string variable in which to store the value of the flag.
      */
      cmd.Flags().StringVar(&name, "name", "", "å§“å")
      // this means: when we type in command line, what comes after "name" will be saved in variable name as string.
      // if we give nothing after "name", the variable name will be the default value "".
      cmd.Flags().StringVar(&sex, "sex", "", "æ€§åˆ«")
      cmd.Flags().Float64Var(&height, "height", 0, "èº«é«˜")
      cmd.Flags().Float64Var(&weight, "weight", 0, "ä½“é‡")
      cmd.Flags().IntVar(&age, "age", 0, "å¹´é¾„")
  ```
åœ¨`main()`å¢žåŠ è¯­å¥è¿è¡Œå·²å®šä¹‰çš„å‘½ä»¤è¡Œå¯¹è±¡ï¼š
  ```
  cmd.Execute()
  ```
åœ¨`Terminal`è¿è¡Œç¨‹åºå¾—åˆ°ï¼š
  ```
  $ go run ./main.go
  name:  
  sex:  
  height:  0
  weight:  0
  age:  0
  ```
é€šè¿‡å‘½ä»¤è¡Œçš„å¸®åŠ©é€‰é¡¹æŸ¥çœ‹é…ç½®ä¸Žä½¿ç”¨æ–¹æ³•ï¼š
  ```
  $ go run ./main.go --help
  å½•å…¥å§“åã€æ€§åˆ«ã€èº«é«˜ã€ä½“é‡å’Œå¹´é¾„ï¼Œè®¡ç®—ä»–ä»¬çš„BMIå€¼ï¼ŒåŸºäºŽä»–ä»¬çš„æ€§åˆ«å’Œå¹´é¾„ç”Ÿæˆä»–ä»¬çš„ä½“è„‚çŽ‡æ ‡å‡†ï¼Œåˆ¤æ–­ä»–ä»¬çš„ä½“è„‚çŽ‡å¤„äºŽåç˜¦/æ ‡å‡†/åèƒ–/ä¸¥é‡è‚¥èƒ–å¹¶ç»™å‡ºå¥åº·å»ºè®®ã€‚
  
  Usage:
    bfrCheck [flags]
  
  Flags:
        --age int        å¹´é¾„
        --height float   èº«é«˜
    -h, --help           help for bfrCheck
        --name string    å§“å
        --sex string     æ€§åˆ«
        --weight float   ä½“é‡
  ```
é€šè¿‡å‘½ä»¤è¡Œå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å®žçŽ°ä¹±åºè¾“å…¥ï¼Œå¹¶ä¸”æ•°æ®æ ¼å¼ä¼šè‡ªåŠ¨è½¬æ¢ã€‚å®žé™…ä½¿ç”¨æ–¹æ³•ä¸ºï¼š
  ```
  $ go run ./main.go --age 35 --name å°å¼º --weight 70 --height 1.70 --sex ç”·
  name:  å°å¼º
  sex:  ç”·
  height:  1.7
  weight:  70
  age:  35
  ```
åœ¨å‘½ä»¤è¡Œå¯¹è±¡çš„`Run`çš„ä¸»ä½“å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒç”¨å…¶å®ƒåŒ…çš„å‡½æ•°å®Œå–„å…¶å®ƒåŠŸèƒ½ã€‚æ¯”å¦‚ï¼š
  ```
  // calculate bmi & bfr...
  bmi := calc.CalcBMI(height, weight)
  bfr := calc.CalcBFRUpgrade(bmi, age, sex)
  fmt.Println("Body Fat Rate:", bfr)
  ```
åœ¨`Terminal`ä¸­è¿è¡ŒåŽå¾—åˆ°çš„ç»“æžœï¼š
  ```
  $ go run ./main.go --age 35 --name å°å¼º --weight 65 --height 1.70 --sex ç”·
  name:  å°å¼º
  sex:  ç”·
  height:  1.7
  weight:  65
  age:  35
  Body Fat Rate: 0.18489619377162636
  ```

> ã€æ€»ç»“ã€‘åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…æ—¶ï¼Œå…ˆå®šä½éœ€è¦ä½¿ç”¨çš„æŸä¸ªå·¥å…·ï¼Œå¯¼å…¥ï¼ˆå·§ç”¨"`_`"æŠ€å·§ï¼‰åŽ`go mod tidy`æ‹‰å–éœ€è¦çš„ç¼ºå°‘çš„æ¨¡å—ï¼Œç§»é™¤ä¸ç”¨çš„æ¨¡å—ã€‚
> ```
> Usage:
>
>    go mod <command> [arguments]
>
> The commands are:
>
>    download    download modules to local cache
>    edit        edit go.mod from tools or scripts
>    graph       print module requirement graph
>    init        initialize new module in current directory
>    tidy        add missing and remove unused modules
>    vendor      make vendored copy of dependencies
>    verify      verify dependencies have expected content
>    why         explain why packages or modules are needed
>
> Use "go help mod <command>" for more information about a command.
> ```